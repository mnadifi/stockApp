<html>
  <head>
    <title>Hello ReactJS - Adding A Table Row - Code Example</title>
    <!-- <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css"> -->
    <script src="http://fb.me/react-0.11.1.js"></script>
    <script src="http://fb.me/JSXTransformer-0.11.1.js"></script>
    <script src="http://code.jquery.com/jquery-1.10.0.min.js"></script>
  </head>
  <body>
    <div class="container">
      <div id="stockApp"></div>  
    </div>
    <script type="text/jsx">
      /** @jsx React.DOM */
      var StockApp = React.createClass({
        getInitialState: function() {
          return {stockitems:this.props.items};
        },
        handleNewItemSubmit: function(newitem) {
          this.setState( {stockitems: this.state.stockitems.concat([newitem])} );
        },
        handleStockRemove: function(stock) {
          
          var index = -1;	
          var clength = this.state.stockitems.length;
      		for( var i = 0; i < clength; i++ ) {
      			if( this.state.stockitems[i].name === stock.name ) {
      				index = i;
      				break;
      			}
      		}
      		this.state.stockitems.splice( index, 1 );	
      		this.setState( {stockitems: this.state.stockitems} );
        },
        render: function() {console.log('Here: ',this.state.stockitems);
          var tableStyle = {width: '100%'};
          var leftTdStyle = {width: '50%',padding:'20px',verticalAlign: 'top'};
          var rightTdStyle = {width: '50%',padding:'20px',verticalAlign: 'top'};
          return ( 
            <table style={tableStyle}>
              <tr>
                <td style={leftTdStyle}>
                  <StockItems clist={this.state.stockitems}  onStockRemove={this.handleStockRemove}/>
                </td>
                <td style={rightTdStyle}>
                  <NewItem onRowSubmit={this.handleNewItemSubmit}/>
                </td>
              </tr>
          </table>
          );
        }
      });
      
      var StockItems = React.createClass({
        handleStockRemove: function(stock){
          this.props.onStockRemove( stock );
        },
        render: function() {
          var items = [];
          var self = this;

          this.props.clist.forEach(function(stock) {
            items.push(<Stock stock={stock} onStockDelete={self.handleStockRemove} /> );
          });
          return ( 
            <div>
              <h3>List of Items</h3>
              <table className="table table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Price</th>
                    <th>Available Date</th>
                    <th>Price</th>
                    <th>Remove</th></tr></thead>
                <tbody>{items}</tbody>
              </table>
            </div>
            );
        }
      });
      
      var Stock = React.createClass({
        handleRemoveStock: function() {
          this.props.onStockDelete( this.props.stock );
          return false;
        },
        render: function() {
          return (
            <tr>
              <td>{this.props.stock.name}</td>
              <td>{this.props.stock.desc}</td>
              <td>{this.props.stock.price}</td>
              <td>{this.props.stock.date}</td>
              <td>{this.props.stock.tax}</td>
              <td><input type="button"  className="btn btn-primary" value="Remove" onClick={this.handleRemoveStock}/></td>
            </tr>
            );
        }
      });
      
      var NewItem = React.createClass({
        handleSubmit: function() {
          let name = this.refs.name.getDOMNode().value,
              desc = this.refs.desc.getDOMNode().value,
              price = this.refs.price.getDOMNode().value,
              date = this.refs.date.getDOMNode().value,
              tax = this.refs.tax.getDOMNode().value,
              newitem = {
                  name: name,
                  desc: desc,
                  price: price,
                  date: date,
                  tax: tax
              };
console.log('Item: ',newitem);
console.log('This: ',this);
console.log('This Props: ',this.props);
          this.props.onRowSubmit( newitem );
          
          this.refs.name.getDOMNode().value = '';
          this.refs.desc.getDOMNode().value = '';
          this.refs.price.getDOMNode().value = '';
          this.refs.date.getDOMNode().value = '';
          this.refs.tax.getDOMNode().value = '';

          return false;
        },
        render: function() {
          var inputStyle = {padding:'12px'}
          return ( 
            <div className="well">
              <h3>Add Item</h3>
            <form onSubmit={this.handleSubmit}>
              <div className="input-group input-group-lg" style={inputStyle}>
                <input type="text"  className="form-control col-md-8"  placeholder="Item Name" ref="name"/>
              </div>
              <div className="input-group input-group-lg" style={inputStyle}>
                <input type="text"  className="form-control col-md-8" placeholder="Description" ref="desc"/>
              </div>
              <div className="input-group input-group-lg" style={inputStyle}>
                <input type="text"  className="form-control col-md-8" placeholder="Price" ref="price"/>
              </div>
              <div className="input-group input-group-lg" style={inputStyle}>
                <input type="date"  className="form-control col-md-8" placeholder="Available Date" ref="date"/>
              </div>
              <div className="input-group input-group-lg" style={inputStyle}>
                <input type="text"  className="form-control col-md-8" placeholder="Taxable" ref="tax"/>
              </div>
              <div className="input-group input-group-lg" style={inputStyle}>
                <input type="submit"  className="btn btn-primary" value="Add Item"/>
              </div>
            </form>
            </div>
            );
        }
      });

      var itemsInfo = [
          {name:"Coffe",desc:"Starbucks",price:10.50,date:"10-12-2016",tax:"Yes"},
          {name:"Bread",desc:"Sliced Bread",price:3.49,date:"10-22-2016",tax:"Yes"}
          ];

      React.renderComponent( <StockApp items={itemsInfo}/>,
                            document.getElementById( "stockApp" ) );
    </script>
  </body>
</html>